# Cassandra Info Dump
## Intro
Cassandra是一种流行的分布式结构化数据存储方案. Cassandra是一个混合型的非关系的数据库, 类似于Google的BigTable. 其主要功能比Dynamo更丰富. Cassandra最初由Facebook开发, 后转变成开源项目. 它是一个网络社交云计算方面理想的数据库. 以Amazon专有的完全分布式的Dynamo为基础, 结合了BigTable基于Column Family的数据模型. P2P去中心化的存储. 很多方面都可以称为Dynamo 2.0
<br>
## Application
许多服务行业是基于用户行为的实时数据分析服务, 既然是实时服务就对性能有非常高的要求. 吞吐量要能满足大量并发用户的请求. 响应时间要足够短不能影响用户正常的业务处理.而数据分析是建立在大数据处理的基础上, 会从各个维度分析用户的行为数据, 因此在用户请求时势必要记录所有用户行为数据, 这是一个非常大的数据量. 单机完全无法满足业务的持续增长, 需要一个能够支持方便水平扩展的数据库系统, 而Cassandra相对传统数据库和其他NoSQL更能贴合这两点的要求.
## Highlights
Cassandra主要特点就是它不是一个数据库, 而是由一堆数据库节点构成的分布式网络服务, 对Cassandra的一个写操作会被复制到其他节点上, 对Cassandra的读操作, 也会被路由到某个节点上面去读取. 对于一个Cassandra群集来说, 扩展性能是比较简单的事情, 只要在群集里添加节点就可以
<br>
<br>Cassandra和其他数据库比较 有以下几个突出特点:
### 模式灵活 高读写性能
(这段话是你看得懂的)
<br>
使用Cassandra, 像文档存储, 你不必提前解决记录中的字段 你可以在系统运行时随意的添加或者移除字段.
<br>
<br>
(这段话是你看了也不知道在写什么的)
<br>
_Cassandra写数据时, 首先会将请求写入Commit Log以确保数据不会丢失, 然后再写入内存中的Memtable, 超过内存容量后再将内存中的数据刷到磁盘的SSTable, 并定期异步对SSTable做数据合并(Compaction)以减少数据读取时的查询时间. 因为写入操作只涉及到顺序写入和内存操作, 因此有非常高的写入性能. 而进行操作时, Cassandra支持像LevelDB一样的实现机制, 数据分层纯粹, 讲热点数据放在Memtable和相对小的SSTable种, 所以能实现非常高的读性能._
<br>
### 可扩展性
Cassandra是纯粹意义上的水平扩展. 为给集群添加更多容量, 可以指向另一台电脑. 不必重启任何进程, 改变应用查询或者手动迁移数据
<br>
### 多数据中心 简单的部署结构
你可以调整你的节点布局来避免某一个数据中心起火, 一个备用的数据中心讲至少有每条记录的完全复制.
<br>
相对HBase等的主从结构, Cassandra是去中心化的P2P结构, 所有节点完全一样没有单点, 对小公司来说,我完全可以选择数据复制份数为2, 先用两三台机器把Cassandra搭起来, 既能保证数据的可靠性也方便今后机器的扩展, 而HBase起码得四五台机器. 以后为了更好的支持客户可能需要在多个地方建立数据中心,而Cassandra对多数据中心支持也很好.对小企业来说 机器寄存在一个小机房里,万一到时候机器满了无法增加要考虑搬迁机房时, 使用多数据中心的方式也能做到无缝迁移.
<br>
### 范围查询
_如果你不喜欢全部的键值查询, 则可以设置键的范围来查询(反正我也不知道是什么意思 写着再说)_
<br>
### 列表数据结构
_在混合模式可以将超级列添加到5维.对于每个用户的索引非常方便(虽然我也不知道为啥方便)_
<br>
### 分布式写操作
可以在任何地方任何时间集中读或者写任何数据, 并且不会有任何单点失败
<br>
<br>
## Basic Structure
Cassandra 没有像BigTable或HBase那样选择中心控制节点, 而选择了无中心的架构, 网络中所有节点都是对等的, 构成了一个环, 节点之间通过P2P协议每秒钟交换一次数据, 这样每个节点都拥有其他所有节点的信息,包括位置和状态 结构如下图
<br>
![Cassandra Ring](http://img2.tuicool.com/fauqimF.png!web)
<br>
客户端可以可以连接集群中任一个节点, 和客户端建立连接的节点叫做协作者(coordinator), 它相当于一个代理, 负责定位该次请求要发到哪些实际拥有本次请求所需数据的节点上去获取.但如何获取并返回, 主要根据客户端要求的一致性级别(Consistency Level)来定, 比如 ONE指只要有一个节点返回数据就能对客户端做出相应, QUONUM指需要返回几个根据用户的配置数目, ALL指等于数据份数的所有节点都返回结果才能向客户端做出相应, 对于数据一致性要求不是特别高的都可以选择ONE, 因为最快.

### Core Components
__Gossip:__ 点对点的通讯协议, 用来相互交换节点的位置和状态信息. 当一个节点启动时就立即改变本地存储的Gossip信息, 但当节点信息发生变化时需要清洗历史信息, 比如IP变了. 通过Gossip协议, _每个节点定期每秒交换它自己和它已经交换过信息的节点的数据_, 每个被交换的信息都有一个版本号, 这样当有新数据时可以覆盖老数据, 为了保证数据交换的准确性, 所有的节点必须使用同一份集群列表 这样的节点又被称为seed.
<br>
__Partitioner:__ 负责在急群众分配数据,由它来决定由哪些节点放第一份copy, 一般情况会使用Hash来做主键, 将每行数据分不到不同的节点上,以确保集群的可扩展性.
<br>
__Replica Placement Strategy:__ 复制策略, 确定哪个节点放置复制数据, 以及复制的份数.
<br>
__Snitch:__ _定义一个网络拓扑图, 用来确定如何放置数据, 高效的处理路由请求.(拓扑图又是什么鬼)(而且为什么要叫做Snitch...)_
__cassandra.yaml:__ 主配置文件, 设置集群的初始化配置, 表的缓存参数, 调优参数和资源使用, 超时设定, 客户端连接, 备份和安全
<br>
<br>
### Putting a reqeust
当写时间发生时, 首先由Commit Log捕获写时间并持久化,保证数据的可靠性. 之后数据也会被写入到内存中, 叫Memtable, 当内存满了之后写入数据文件, 叫SSTable. 它是Log-Structured Storage Table的简称. 如果客户端配置了Consistency Level是ONE, 意味着只要有个一节点写入成功 就由代理节点(Coordinator)返回给客户端写入完成. 当然这中间可能会有其他节点写入失败的情况. Cassandra自己会通过Hinted Handoff或者Read Repair或者Anti-entropy Node Repair方式保证数据最终一致性. 
<br><br>
对于多数据中心的写入请求, Cassandra做了优化, 每个数据中心选取一个Coordinator来完成它所在的数据中心的数据复制, 这样客户端连接的节点至于要向数据中心的一个节点转发复制请求即可. 有这个数据中心的Coordinator来完成这个数据中心内的数据复制 
<br><br>
Cassandra的存储结构类似LSM树这种结构 不像传统数据一般都使用B+树 存储引擎以追加的方式顺序写入磁盘连续存储数据, 写入是可以并发写入, 不像B+树一样需要加锁, 写入速度非常高, LevelDB, Hbase都是使用类似的存储结构.
<br><br>
然后后面写的我就不懂了




